<div class="container container-page">
  <div class="nav">
    <h1>Listado de categorías</h1>
    <div class="info-user">
      <p>{{emailUser}}</p>
      <a (click)="logout()">Cerrar sesión</a>
    </div>
  </div>

  <!-- Formulario para crear nueva categoría -->
  <div class="create-category-form" *ngIf="showCreateForm">
    <h3>Crear Nueva Categoría</h3>
    <form [formGroup]="createCategoryForm" (ngSubmit)="onCreateSubmit()">
      <div class="form-group">
        <label for="newTitle">Nombre de la Categoría</label>
        <input
          type="text"
          id="newTitle"
          formControlName="title"
          class="form-control"
          [class.is-invalid]="titleControl?.invalid && titleControl?.touched"
          placeholder="Ingrese el nombre de la nueva categoría">

        <div class="error-message" *ngIf="titleControl?.invalid && titleControl?.touched">
          <span *ngIf="titleControl?.errors?.['required']">El nombre de la categoría es requerido</span>
          <span *ngIf="titleControl?.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</span>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-base btn-cancel" (click)="cancelCreate()">
          <span class="material-symbols-outlined">cancel</span>
          Cancelar
        </button>
        <button type="submit" class="btn-base btn-save" [disabled]="createCategoryForm.invalid || isCreating">
          <span class="material-symbols-outlined" *ngIf="!isCreating">add</span>
          <span class="loading-spinner" *ngIf="isCreating"></span>
          {{ isCreating ? 'Creando...' : 'Crear Categoría' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Botón para mostrar formulario de creación -->
  <div class="create-button-container" *ngIf="!showCreateForm">
    <button class="btn-base btn-create" (click)="showCreateForm = true">
      <span class="material-symbols-outlined">add</span>
      Crear Nueva Categoría
    </button>
  </div>

  <div class="cont-table">
    <table>
      <thead>
        <tr>
          <th>Id</th>
          <th>Categoría</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (categoria of menuCategories; track categoria; let i = $index) {
          <tr *ngIf="categoria?.id">
            <td>{{categoria?.id}}</td>
            <td>{{categoria?.title}}</td>
            <td>
              <button
                class="btn-base btn-edit"
                (click)="navigateToEdit(categoria?.id)"
                type="button">
                <span class="material-symbols-outlined">edit</span>
                Editar
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
